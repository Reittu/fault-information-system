(this["webpackJsonpfault-information-system"]=this["webpackJsonpfault-information-system"]||[]).push([[0],{104:function(e,t,n){e.exports=n(118)},109:function(e,t,n){},117:function(e,t,n){},118:function(e,t,n){"use strict";n.r(t);var a,r=n(0),c=n.n(r),o=n(16),i=n.n(o),l=(n(109),n(18)),u=n.n(l),s=n(17),p=n(23),d=n(3),f=n(169),m=n(170),b=n(167),g=n(120),h=n(168),y=n(81),E=n.n(y),v=n(6),O=n(41),x=n(11),j=n(180),w=n(182),k=n(78),I=n.n(k),S=n(14),N=function(e){return{type:"VIEWPORT",payload:e}},C=function(e){return{type:"SET-MARKERS",payload:e}},R="pk.eyJ1IjoicmVpdHR1IiwiYSI6ImNrN3JzNGZ5YjBobDkzbnF0YWhpc2w2YWgifQ.J0RkOIvmwOXs21WSOEDRMg",L=function(){var e=Object(p.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.trim().toLowerCase(),e.next=3,n.length;case 3:if(e.t0=e.sent,!(e.t0<2)){e.next=8;break}e.t1=[],e.next=9;break;case 8:e.t1=T(t);case 9:return e.abrupt("return",e.t1);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function T(e){return D.apply(this,arguments)}function D(){return(D=Object(p.a)(u.a.mark((function e(t){var n,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://api.mapbox.com/geocoding/v5/mapbox.places/"+t+".json?access_token="+R);case 2:return n=e.sent,e.next=5,n.json();case 5:return a=e.sent,e.abrupt("return",a.features||[]);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var B=function(e){var t=Object(r.useState)([]),n=Object(x.a)(t,2),o=n[0],i=n[1],l=Object(r.useState)(""),s=Object(x.a)(l,2),d=s[0],f=s[1],m=Object(S.c)((function(e){return e.viewport})),b=Object(S.b)();return Object(r.useEffect)((function(){function e(){return(e=Object(p.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=i,e.next=3,L(d);case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}clearTimeout(a),a=setTimeout((function(){return e.apply(this,arguments)}),300)}),[d]),c.a.createElement("div",{style:{alignItems:"center",display:"flex"}},c.a.createElement(I.a,null),c.a.createElement(w.a,{freeSolo:!0,style:{flex:1},onInputChange:function(e,t){return f(t)},options:o,renderInput:function(e){return c.a.createElement(j.a,Object.assign({},e,{label:"Search for a location...",margin:"normal",variant:"outlined"}))},getOptionLabel:function(e){return e.place_name},renderOption:function(e){return c.a.createElement("div",{onClick:function(){b(N(Object(O.a)({},m,{longitude:Number(e.center[0]),latitude:Number(e.center[1]),zoom:16})))}},e.place_name)}}))},W=Object(h.a)((function(e){return{appBar:{zIndex:e.zIndex.drawer+1},appBarShift:{marginLeft:Re,width:"calc(100% - ".concat(Re,"px)")},menuButton:{marginRight:36},hide:{opacity:.5},searchBox:{width:"300px","& .MuiFormControl-root":{margin:"0 0 0 5px"},"& .MuiInputBase-root":{paddingTop:0,paddingBottom:0},"& .MuiInputLabel-outlined":{padding:0,color:"#fff",transform:"translate(14px, 12px) scale(1)"},"& .MuiInputLabel-shrink":{transform:"translate(14px, -6px) scale(0.75)"},"& .MuiTextField":{color:"#fff"},"& .Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#fff"}},toolbar:{justifyContent:"space-between"}}}));function A(){var e=W(),t=Object(S.c)((function(e){return e.drawerIsOpen})),n=Object(S.b)();return c.a.createElement(f.a,{position:"fixed",className:Object(v.a)(e.appBar,Object(d.a)({},e.appBarShift,t))},c.a.createElement(m.a,{className:e.toolbar},c.a.createElement(b.a,{color:"inherit","aria-label":"open drawer",onClick:t?function(){return n({type:"CLOSE-DRAWER"})}:function(){return n({type:"OPEN-DRAWER"})},edge:"start",className:Object(v.a)(e.menuButton,Object(d.a)({},e.hide,t))},c.a.createElement(E.a,null)),c.a.createElement(g.a,{variant:"h6",noWrap:!0},"Fault Information System"),c.a.createElement("div",{className:e.searchBox},c.a.createElement(B,null))))}var F=n(25),G=n(183),M=n(88),z=n.n(M),P=n(87),J=n.n(P),Y=n(171),_=n(184),V=n(172),q=n(82),X=n.n(q),H=n(83),K=n.n(H),Q=n(84),Z=n.n(Q),U=n(86),$=n.n(U),ee=n(85),te=n.n(ee),ne=Object(h.a)((function(e){return{buttonGroup:{flexDirection:"column"},toggleButton:{justifyContent:"flex-start",textTransform:"none"},listIcon:{minWidth:"56px",padding:"0 16px",marginRight:"12px"}}}));function ae(){var e=ne(),t=Object(S.c)((function(e){return e.tool})),n=Object(S.b)();return c.a.createElement(c.a.Fragment,null,c.a.createElement(_.a,{className:e.buttonGroup,size:"small",value:t,exclusive:!0,onChange:function(e,t){return n({type:"TOOL",payload:t})}},c.a.createElement(Y.a,{className:e.toggleButton,value:"add",title:"Report new faults"},c.a.createElement(X.a,{className:e.listIcon}),c.a.createElement(g.a,{variant:"body1"},"Report a new fault")),c.a.createElement(Y.a,{className:e.toggleButton,value:"edit",title:"Edit existing faults"},c.a.createElement(K.a,{className:e.listIcon}),c.a.createElement(g.a,{variant:"body1"},"Edit submitted faults")),c.a.createElement(Y.a,{className:e.toggleButton,value:"delete",title:"Remove faults"},c.a.createElement(Z.a,{className:e.listIcon}),c.a.createElement(g.a,{variant:"body1"},"Delete faults")),c.a.createElement(Y.a,{className:e.toggleButton,value:"review",title:"Review faults in detail"},c.a.createElement(te.a,{className:e.listIcon}),c.a.createElement(g.a,{variant:"body1"},"Review faults"))),c.a.createElement(V.a,{className:e.toggleButton,onClick:function(){navigator.geolocation?navigator.geolocation.getCurrentPosition((function(e){e.coords&&n(N({longitude:e.coords.longitude,latitude:e.coords.latitude,zoom:16,bearing:0,pitch:0}))})):alert("Your browser does not support GeoLocation.")},title:"Center map to your location"},c.a.createElement($.a,{className:e.listIcon}),c.a.createElement(g.a,{variant:"body1"},"Center to your location")))}var re=Object(h.a)((function(e){return{drawer:{width:Re,flexShrink:0,whiteSpace:"nowrap"},drawerOpen:{width:Re},drawerClose:Object(d.a)({overflowX:"hidden",width:e.spacing(7)+1},e.breakpoints.up("sm"),{width:e.spacing(9)+1}),toolbar:Object(O.a)({display:"flex",alignItems:"center",justifyContent:"flex-end",padding:e.spacing(0,1)},e.mixins.toolbar),buttonGroup:{flexDirection:"column"},toggleButton:{justifyContent:"flex-start",textTransform:"none"},listIcon:{minWidth:"56px",padding:"0 16px",marginRight:"12px"}}}));function ce(e){var t,n,a=re(),r=Object(F.a)(),o=Object(S.c)((function(e){return e.drawerIsOpen})),i=Object(S.b)();return c.a.createElement(G.a,{variant:"permanent",className:Object(v.a)(a.drawer,(t={},Object(d.a)(t,a.drawerOpen,o),Object(d.a)(t,a.drawerClose,!o),t)),classes:{paper:Object(v.a)((n={},Object(d.a)(n,a.drawerOpen,o),Object(d.a)(n,a.drawerClose,!o),n))}},c.a.createElement("div",{className:a.toolbar},c.a.createElement(b.a,{onClick:function(){return i({type:"CLOSE-DRAWER"})}},"rtl"===r.direction?c.a.createElement(J.a,null):c.a.createElement(z.a,null))),c.a.createElement(ae,null))}var oe=n(58),ie=n(90),le=n.n(ie),ue="https://ey86blceac.execute-api.us-east-1.amazonaws.com/prod/reports",se=function(e,t){return{method:t,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}},pe=function(){var e=Object(p.a)(u.a.mark((function e(t,n,a){var r,c,o,i,l=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.length>3&&void 0!==l[3]?l[3]:function(e){return alert(e)},e.prev=1,e.next=4,fetch(ue,se(t,n));case 4:return c=e.sent,e.next=7,c.json();case 7:o=e.sent,i=JSON.parse(o.body).message,a(i),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),r("Request to server failed: "+e.t0);case 15:case"end":return e.stop()}}),e,null,[[1,12]])})));return function(t,n,a){return e.apply(this,arguments)}}();function de(){return(de=Object(p.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pe(void 0,"GET",t);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function fe(){return(fe=Object(p.a)(u.a.mark((function e(t,n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pe(t,"POST",n);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function me(){return(me=Object(p.a)(u.a.mark((function e(t,n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pe(t,"PUT",n);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function be(){return(be=Object(p.a)(u.a.mark((function e(t,n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pe(t,"DELETE",n);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ge(e){return he.apply(this,arguments)}function he(){return(he=Object(p.a)(u.a.mark((function e(t){var n,a,r,c,o,i,l,s,p,d,f,m;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:return n=e.sent,e.next=5,n.json();case 5:if(a=e.sent,0!==(r=a.features.filter((function(e){return"place"===e.place_type[0]}))).length){e.next=10;break}return alert("Marked location is not located in a country."),e.abrupt("return",{});case 10:if(c=r[0].place_name.split(", "),o=Object(x.a)(c,3),i=o[0],l=o[1],"Finland"===(s=o[2])){e.next=14;break}return alert("This app is currently restricted to Finland only. Your marker was located in: "+l+", "+s),e.abrupt("return",{});case 14:return(f=a.features.filter((function(e){return"address"===e.place_type[0]}))).length>0&&(p=f[0].place_name.split(", ")[0]),(m=a.features.filter((function(e){return"postcode"===e.place_type[0]}))).length>0&&(d=m[0].text),e.abrupt("return",{city:i,address:p,postcode:d});case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ye=function(e){var t=e.address,n=e.city,a=e.postcode,r=e.description,o=e.latitude,i=e.longitude,l=e.offsetLeft,u=e.offsetTop,s=e.reporter,p=e.subject,d=e.markerIndex,f=e.dbIndex,m=Object(S.c)((function(e){return e.tool})),b=Object(S.c)((function(e){return e.markers})),g=Object(S.b)();return c.a.createElement(oe.a,{latitude:o,longitude:i,offsetLeft:l,offsetTop:u},c.a.createElement("div",{style:{alignItems:"center",display:"flex",fontWeight:"bold",cursor:"pointer"},onClick:function(){if("delete"===m){function e(){var e=b.filter((function(e,t){return t!==d}));g(C(e))}if(!f)return e();if("guest"!==s)return alert("Not authorized as guest to delete a report posted by admin.");window.confirm("Delete this marker?")&&function(e,t){be.apply(this,arguments)}({id:f},(function(t){var n=t.recordsets[0][0].result;"Success"===n?e():alert("Failed to delete this report: "+n)}))}else g({type:"SET-DIALOG",payload:{address:t,city:n,postcode:a,subject:p,description:r,reporter:s,markerIndex:d,latitude:o,longitude:i}}),g({type:"OPEN-DIALOG"})}},c.a.createElement(le.a,null),c.a.createElement("span",null,p)))},Ee=n(181),ve=n(176),Oe=n(175),xe=n(174),je=n(173);function we(){var e=Object(S.c)((function(e){return e.dialogIsOpen})),t=Object(S.c)((function(e){return e.dialogContent})),n=Object(S.c)((function(e){return e.tool})),a=Object(S.c)((function(e){return e.markers})),o=Object(r.useState)(""),i=Object(x.a)(o,2),l=i[0],u=i[1],p=Object(r.useState)(""),d=Object(x.a)(p,2),f=d[0],m=d[1],b=Object(S.b)(),h=Object(r.useRef)(null),y=function(){return b({type:"CLOSE-DIALOG"})},E=function(){h.current.requestSubmit()},v=function(e){if(e.preventDefault(),h.current.reportValidity()){var n=a.map((function(e,n){if(n===t.markerIndex){var r=e.latitude,c=e.longitude,o=e.city,i=e.postcode,u=e.address;return e.id?function(e,t){me.apply(this,arguments)}({id:e.id,subject:l,description:f},(function(e){var t=e.recordsets[0][0].result;"Success"!==t&&alert("Failed to update report: "+t)})):function(e,t){fe.apply(this,arguments)}({subject:l,description:f,latitude:r,longitude:c,city:o,postcode:i,address:u},(function(e){var t=Object(s.a)(a);t[n].id=Number(e.recordsets[0][0].result),t[n].subject=l,t[n].description=f,b(C(t))})),Object(O.a)({},e,{subject:l,description:f})}return e}));b(C(n)),y()}};return c.a.createElement(ve.a,{onEnter:function(){u(t.subject),m(t.description)},open:e,onClose:function(){return y()},"aria-labelledby":"form-dialog-title"},"review"===n?c.a.createElement(c.a.Fragment,null,c.a.createElement(je.a,{id:"form-dialog-title"},l),c.a.createElement(xe.a,null,c.a.createElement(Ee.a,{color:"text.secondary",pb:"16px"},c.a.createElement(Ee.a,{mb:"16px"},c.a.createElement(g.a,{display:"inline"},"Reported by: "),c.a.createElement(g.a,{display:"inline",color:"primary"},t.reporter)),c.a.createElement(Ee.a,{mb:"16px"},c.a.createElement(g.a,null,t.address,", ",t.postcode,", ",t.city),c.a.createElement(g.a,null,"Latitude: ",t.latitude),c.a.createElement(g.a,null,"Longitude: ",t.longitude)),c.a.createElement(g.a,{color:"textPrimary"},f)))):c.a.createElement(c.a.Fragment,null,c.a.createElement(je.a,{id:"form-dialog-title"},"Fault Details"),c.a.createElement(xe.a,null,c.a.createElement(Ee.a,{color:"text.secondary",mb:"16px"},c.a.createElement(Ee.a,{mb:"8px"},c.a.createElement(g.a,{color:"textSecondary",display:"inline"},"Reported by: "),c.a.createElement(g.a,{color:"primary",display:"inline"},t.reporter)),c.a.createElement(g.a,null,"Set a subject text that appears in the map and a more in-depth description of the issue.")),c.a.createElement("form",{ref:h,onSubmit:v},c.a.createElement("fieldset",{disabled:"guest"!==t.reporter,style:{all:"unset"}},c.a.createElement(j.a,{autoFocus:!0,margin:"dense",id:"subject",label:"Subject",type:"text",fullWidth:!0,value:l,onChange:function(e){return u(e.target.value)},inputProps:{minLength:3,maxLength:50},required:!0}),c.a.createElement(j.a,{margin:"dense",id:"description",label:"Description",type:"text",fullWidth:!0,value:f,onChange:function(e){return m(e.target.value)},inputProps:{minLength:5,maxLength:500},multiline:!0,rows:"2",required:!0}),c.a.createElement("input",{type:"submit",style:{display:"none"}})))),c.a.createElement(Oe.a,null,c.a.createElement(V.a,{onClick:y,color:"primary"},"Cancel"),c.a.createElement(V.a,{onClick:E,color:"primary",disabled:"guest"!==t.reporter},"Save"))))}n(117);var ke=n(179),Ie=n(91),Se=n(178),Ne=n(177),Ce=n(59),Re=260,Le={palette:{primary:Ne.a,secondary:Ce.a,type:"light"}},Te="pk.eyJ1IjoicmVpdHR1IiwiYSI6ImNrN3JzNGZ5YjBobDkzbnF0YWhpc2w2YWgifQ.J0RkOIvmwOXs21WSOEDRMg",De=Object(h.a)((function(e){return{root:{display:"flex"},content:{flexGrow:1,height:"100vh",paddingTop:"56px",overflow:"hidden"},addToolSelected:{"&>div":{cursor:"pointer !important"}},"@media (orientation: landscape)":{content:{paddingTop:"48px"}},"@media (min-width: 600px)":{content:{paddingTop:"64px"}}}}));var Be=function(){var e=Object(Ie.a)(Le),t=De(),n=Object(S.c)((function(e){return e.markers})),a=Object(S.c)((function(e){return e.viewport})),o=Object(S.c)((function(e){return e.tool})),i=Object(S.b)();Object(r.useEffect)((function(){!function(e){de.apply(this,arguments)}((function(e){return i(C(e.recordset))}))}),[i]);var l=function(){var e=Object(p.a)(u.a.mark((function e(t){var a,r,c,l,p,d,f;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("add"!==o){e.next=21;break}if("DIV"===t.target.tagName){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,ge("https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(t.lngLat[0],",").concat(t.lngLat[1],".json?access_token=").concat(Te));case 6:if(a=e.sent,r=a.city,c=a.address,l=void 0===c?"---":c,p=a.postcode,d=void 0===p?"---":p,r){e.next=14;break}return e.abrupt("return");case 14:f={address:l,city:r,description:"".concat(l,", ").concat(d,", ").concat(r),id:null,latitude:t.lngLat[1],longitude:t.lngLat[0],postcode:d,reporter:"guest",subject:"New marker"},i(C([].concat(Object(s.a)(n),[f]))),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(3),alert("Failed to fetch data: "+e.t0);case 21:case"end":return e.stop()}}),e,null,[[3,18]])})));return function(t){return e.apply(this,arguments)}}();return c.a.createElement(Se.a,{theme:e},c.a.createElement("div",{className:t.root},c.a.createElement(ke.a,null),c.a.createElement(ce,null),c.a.createElement(A,null),c.a.createElement("main",{className:"add"===o?"".concat(t.content," ").concat(t.addToolSelected):t.content},c.a.createElement(oe.b,Object.assign({},a,{width:"100%",height:"100%",mapStyle:"mapbox://styles/mapbox/streets-v11",onViewportChange:function(e){return i(N(e))},mapboxApiAccessToken:Te,onMouseDown:l}),c.a.useCallback(n.map((function(e,t){return c.a.createElement(ye,{key:t,markerIndex:t,address:e.address,city:e.city,postcode:e.postcode,dbIndex:e.id,longitude:e.longitude,latitude:e.latitude,subject:e.subject,description:e.description,reporter:e.reporter,offsetTop:-24,offsetLeft:-12})})),[n])),c.a.createElement(we,null))))},We=n(42),Ae=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"OPEN-DRAWER":return!0;case"CLOSE-DRAWER":return!1;default:return e}},Fe={longitude:26.2,latitude:62.1,zoom:4.9,bearing:0,pitch:0},Ge=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Fe,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"VIEWPORT":return t.payload;default:return e}},Me=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"edit",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"TOOL":return t.payload;default:return e}},ze=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET-MARKERS":return t.payload;default:return e}},Pe=Object(We.b)({drawerIsOpen:Ae,viewport:Ge,tool:Me,dialogIsOpen:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"OPEN-DIALOG":return!0;case"CLOSE-DIALOG":return!1;default:return e}},dialogContent:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{address:"",city:"",postcode:"",subject:"",description:"",reporter:"",markerIndex:0,latitude:0,longitude:0},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET-DIALOG":return t.payload;default:return e}},markers:ze}),Je=Object(We.c)((function(e,t){return"RESET"===t.type&&(e=void 0),Pe(e,t)}));i.a.render(c.a.createElement(S.a,{store:Je},c.a.createElement(Be,null)),document.getElementById("root"))}},[[104,1,2]]]);
//# sourceMappingURL=main.e3ea1545.chunk.js.map